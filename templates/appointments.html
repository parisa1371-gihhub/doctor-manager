{% extends 'base.html' %}
{% load static %}
{% load jalali %}

{% block title %}قرار ملاقات‌ها - سیستم مدیریت بیماران{% endblock %}
{% block page_title %}قرار ملاقات‌ها{% endblock %}
{% block page_subtitle %}مدیریت قرار ملاقات‌های بیماران{% endblock %}

{% block content %}
<div style="padding: 2rem;">
    <!-- Header Section -->
    <div style="background: linear-gradient(to right, #f0f9ff, #e0f2fe); border-radius: 1rem; padding: 1.5rem; border: 1px solid #bae6fd; margin-bottom: 2rem;">
        <div style="display: flex; flex-direction: column; align-items: flex-start;">
            <h2 style="font-size: 1.5rem; font-weight: bold; color: #111827; margin-bottom: 0.5rem;">قرار ملاقات‌ها</h2>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <span style="display: flex; align-items: center; color: #0284c7;">
                    <i data-lucide="calendar" style="width: 1rem; height: 1rem; margin-left: 0.5rem;"></i>
                    {{ total_appointments }} قرار ملاقات
                </span>
            </div>
        </div>
    </div>

    <!-- Upcoming Appointments -->
    {% if upcoming_appointments %}
    <div style="background: white; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <div style="width: 2rem; height: 2rem; background: #dcfce7; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; margin-left: 0.75rem;">
                <i data-lucide="clock" style="width: 1.25rem; height: 1.25rem; color: #16a34a;"></i>
            </div>
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #374151;">قرار ملاقات‌های نزدیک (7 روز آینده)</h3>
        </div>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            {% for appointment in upcoming_appointments %}
            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 0.75rem; padding: 1rem;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 3rem; height: 3rem; background: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="user" style="width: 1.5rem; height: 1.5rem; color: #16a34a;"></i>
                        </div>
                        <div>
                            <h4 style="font-weight: 600; color: #111827;">{{ appointment.visit.patient.full_name }}</h4>
                            <p style="font-size: 0.875rem; color: #6b7280;">کد ملی: {{ appointment.visit.patient.national_id }}</p>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 0.875rem; font-weight: 500; color: #15803d;">{{ appointment.visit.next_visit_date|jalali:"%Y/%m/%d" }}</p>
                        <p style="font-size: 0.75rem; color: #6b7280;">تاریخ قرار ملاقات</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- All Appointments -->
    <div style="background: white; border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <div style="width: 2rem; height: 2rem; background: #e0f2fe; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; margin-left: 0.75rem;">
                <i data-lucide="calendar-days" style="width: 1.25rem; height: 1.25rem; color: #0284c7;"></i>
            </div>
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #374151;">همه قرار ملاقات‌ها</h3>
        </div>
        
        {% if appointments %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f8fafc;">
                        <th style="padding: 0.75rem; text-align: right; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0;">بیمار</th>
                        <th style="padding: 0.75rem; text-align: right; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0;">کد ملی</th>
                        <th style="padding: 0.75rem; text-align: right; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0;">تاریخ ویزیت قبلی</th>
                        <th style="padding: 0.75rem; text-align: right; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0;">تاریخ قرار ملاقات</th>
                        <th style="padding: 0.75rem; text-align: right; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0;">تشخیص</th>
                        <th style="padding: 0.75rem; text-align: right; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0;">عملیات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appointment in appointments %}
                    <tr style="border-bottom: 1px solid #f1f5f9;">
                        <td style="padding: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 2rem; height: 2rem; background: #e0f2fe; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i data-lucide="user" style="width: 1rem; height: 1rem; color: #0284c7;"></i>
                                </div>
                                <span style="font-weight: 500; color: #111827;">{{ appointment.patient.full_name }}</span>
                            </div>
                        </td>
                        <td style="padding: 0.75rem; color: #6b7280;">{{ appointment.patient.national_id }}</td>
                        <td style="padding: 0.75rem; color: #6b7280;">{{ appointment.visit_date|jalali:"%Y/%m/%d" }}</td>
                        <td style="padding: 0.75rem;">
                            <span style="background: #dbeafe; color: #1d4ed8; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.875rem;">{{ appointment.next_visit_date|jalali:"%Y/%m/%d" }}</span>
                        </td>
                        <td style="padding: 0.75rem; color: #6b7280; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ appointment.diagnosis }}">
                            {{ appointment.diagnosis|truncatechars:50 }}
                        </td>
                        <td style="padding: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <a href="{% url 'patient_detail' appointment.patient.id %}" 
                                   style="background: #f1f5f9; color: #475569; padding: 0.375rem 0.75rem; border-radius: 0.375rem; text-decoration: none; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">
                                    <i data-lucide="eye" style="width: 0.75rem; height: 0.75rem;"></i>
                                    مشاهده
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem 0;">
            <div style="width: 4rem; height: 4rem; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                <i data-lucide="calendar-x" style="width: 2rem; height: 2rem; color: #9ca3af;"></i>
            </div>
            <h3 style="font-size: 1.125rem; font-weight: 500; color: #111827; margin-bottom: 0.5rem;">هیچ قرار ملاقات‌ای ثبت نشده</h3>
            <p style="color: #6b7280; margin-bottom: 1.5rem;">هنوز قرار ملاقات‌ای برای بیماران تعیین نشده است.</p>
            <a href="{% url 'patients' %}" style="background: #0284c7; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="users" style="width: 1rem; height: 1rem;"></i>
                مشاهده بیماران
            </a>
        </div>
        {% endif %}
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Lucide icons
    lucide.createIcons();
});
</script>
{% endblock %}
