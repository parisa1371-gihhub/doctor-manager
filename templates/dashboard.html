{% extends 'base.html' %}
{% load static %}
{% load jalali %}

{% block title %}داشبورد - سیستم مدیریت بیماران{% endblock %}
{% block page_title %}داشبورد{% endblock %}
{% block page_subtitle %}نمای کلی از مطب شما{% endblock %}

{% block content %}
<div style="padding: 24px;">
    <!-- Welcome Section -->
    <div style="background: linear-gradient(to right, #0284c7, #0369a1); border-radius: 16px; padding: 32px; color: white; margin-bottom: 32px;">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <h1 style="font-size: 28px; font-weight: bold; margin-bottom: 8px;">سلام، دکتر {{ user.get_full_name|default:user.username }}!</h1>
                <p style="color: #bae6fd; font-size: 18px;">به سیستم مدیریت بیماران خوش آمدید</p>
            </div>
            <div style="display: none;" class="lg:block">
                <div style="width: 80px; height: 80px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="stethoscope" style="width: 40px; height: 40px; color: white;"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px;">
        <div class="stat-card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 14px; font-weight: 500; color: #6b7280; margin-bottom: 4px;">کل بیماران</p>
                    <p style="font-size: 32px; font-weight: bold; color: #111827;">{{ total_patients|default:"0" }}</p>
                    <p style="font-size: 12px; color: #059669; margin-top: 4px;">
                        <i data-lucide="trending-up" style="width: 12px; height: 12px; display: inline; margin-left: 4px;"></i>
                        +12% از ماه گذشته
                    </p>
                </div>
                <div class="stat-card-icon" style="background: linear-gradient(to bottom right, #3b82f6, #2563eb); color: white;">
                    <i data-lucide="users" style="width: 24px; height: 24px;"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 14px; font-weight: 500; color: #6b7280; margin-bottom: 4px;">ویزیت‌های امروز</p>
                    <p style="font-size: 32px; font-weight: bold; color: #111827;">{{ today_visits|default:"0" }}</p>
                    <p style="font-size: 12px; color: #0284c7; margin-top: 4px;">
                        <i data-lucide="calendar" style="width: 12px; height: 12px; display: inline; margin-left: 4px;"></i>
                        امروز
                    </p>
                </div>
                <div class="stat-card-icon" style="background: linear-gradient(to bottom right, #059669, #047857); color: white;">
                    <i data-lucide="calendar-check" style="width: 24px; height: 24px;"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 14px; font-weight: 500; color: #6b7280; margin-bottom: 4px;">این هفته</p>
                    <p style="font-size: 32px; font-weight: bold; color: #111827;">{{ week_visits|default:"0" }}</p>
                    <p style="font-size: 12px; color: #d97706; margin-top: 4px;">
                        <i data-lucide="clock" style="width: 12px; height: 12px; display: inline; margin-left: 4px;"></i>
                        هفته جاری
                    </p>
                </div>
                <div class="stat-card-icon" style="background: linear-gradient(to bottom right, #d97706, #b45309); color: white;">
                    <i data-lucide="calendar" style="width: 24px; height: 24px;"></i>
                </div>
            </div>
        </div>
        
        <div class="stat-card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <p style="font-size: 14px; font-weight: 500; color: #6b7280; margin-bottom: 4px;">این ماه</p>
                    <p style="font-size: 32px; font-weight: bold; color: #111827;">{{ month_visits|default:"0" }}</p>
                    <p style="font-size: 12px; color: #7c3aed; margin-top: 4px;">
                        <i data-lucide="trending-up" style="width: 12px; height: 12px; display: inline; margin-left: 4px;"></i>
                        ماه جاری
                    </p>
                </div>
                <div class="stat-card-icon" style="background: linear-gradient(to bottom right, #7c3aed, #6d28d9); color: white;">
                    <i data-lucide="bar-chart-3" style="width: 24px; height: 24px;"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions & Recent Activity -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 32px; margin-bottom: 32px;">
        <!-- Quick Actions Card -->
        <div class="card">
            <div class="card-header">
                <h3 style="font-size: 20px; font-weight: 600; color: #111827; display: flex; align-items: center;">
                    <i data-lucide="zap" style="width: 20px; height: 20px; margin-left: 8px; color: #0284c7;"></i>
                    اقدامات سریع
                </h3>
            </div>
            <div style="display: flex; flex-direction: column; gap: 16px;">
                <a href="{% url 'add_patient' %}" style="display: flex; align-items: center; padding: 16px; background: linear-gradient(to right, #dbeafe, #bfdbfe); border-radius: 12px; border: 1px solid #93c5fd; text-decoration: none; transition: all 0.2s;">
                    <div style="width: 48px; height: 48px; background: linear-gradient(to bottom right, #3b82f6, #2563eb); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i data-lucide="user-plus" style="width: 24px; height: 24px; color: white;"></i>
                    </div>
                    <div style="margin-left: 16px; flex: 1;">
                        <p style="font-weight: 600; color: #111827; margin: 0;">افزودن بیمار جدید</p>
                        <p style="font-size: 14px; color: #6b7280; margin: 0;">ثبت اطلاعات بیمار جدید در سیستم</p>
                    </div>
                    <i data-lucide="arrow-left" style="width: 20px; height: 20px; color: #9ca3af;"></i>
                </a>
                
                <a href="{% url 'patients' %}" style="display: flex; align-items: center; padding: 16px; background: linear-gradient(to right, #dcfce7, #bbf7d0); border-radius: 12px; border: 1px solid #86efac; text-decoration: none; transition: all 0.2s;">
                    <div style="width: 48px; height: 48px; background: linear-gradient(to bottom right, #059669, #047857); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i data-lucide="users" style="width: 24px; height: 24px; color: white;"></i>
                    </div>
                    <div style="margin-left: 16px; flex: 1;">
                        <p style="font-weight: 600; color: #111827; margin: 0;">مشاهده همه بیماران</p>
                        <p style="font-size: 14px; color: #6b7280; margin: 0;">مرور و مدیریت پرونده بیماران</p>
                    </div>
                    <i data-lucide="arrow-left" style="width: 20px; height: 20px; color: #9ca3af;"></i>
                </a>
                
                <a href="{% url 'appointments' %}" style="display: flex; align-items: center; padding: 16px; background: linear-gradient(to right, #fef3c7, #fde68a); border-radius: 12px; border: 1px solid #fbbf24; text-decoration: none; transition: all 0.2s;">
                    <div style="width: 48px; height: 48px; background: linear-gradient(to bottom right, #d97706, #b45309); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i data-lucide="calendar-plus" style="width: 24px; height: 24px; color: white;"></i>
                    </div>
                    <div style="margin-left: 16px; flex: 1;">
                        <p style="font-weight: 600; color: #111827; margin: 0;">تعیین قرار ملاقات</p>
                        <p style="font-size: 14px; color: #6b7280; margin: 0;">رزرو قرار ملاقات جدید</p>
                    </div>
                    <i data-lucide="arrow-left" style="width: 20px; height: 20px; color: #9ca3af;"></i>
                </a>
            </div>
        </div>
        
        <!-- Recent Visits Card -->
        <div class="card">
            <div class="card-header">
                <h3 style="font-size: 20px; font-weight: 600; color: #111827; display: flex; align-items: center;">
                    <i data-lucide="clock" style="width: 20px; height: 20px; margin-left: 8px; color: #0284c7;"></i>
                    ویزیت‌های اخیر
                </h3>
            </div>
            {% if recent_visits %}
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    {% for visit in recent_visits %}
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: #f9fafb; border-radius: 12px; transition: background-color 0.2s;">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 48px; height: 48px; background: linear-gradient(to bottom right, #e0f2fe, #bae6fd); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i data-lucide="user" style="width: 24px; height: 24px; color: #0284c7;"></i>
                            </div>
                            <div style="margin-left: 16px;">
                                <p style="font-weight: 600; color: #111827; margin: 0;">{{ visit.patient.full_name }}</p>
                                <p style="font-size: 14px; color: #6b7280; margin: 0; display: flex; align-items: center;">
                                    <i data-lucide="calendar" style="width: 12px; height: 12px; margin-left: 4px;"></i>
                                    {{ visit.visit_date|jalali:"%Y/%m/%d - %H:%M" }}
                                </p>
                            </div>
                        </div>
                        <a href="{% url 'patient_detail' visit.patient.id %}" style="padding: 8px; color: #9ca3af; border-radius: 8px; transition: all 0.2s;">
                            <i data-lucide="eye" style="width: 20px; height: 20px;"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                    <a href="{% url 'patients' %}" style="color: #0284c7; font-size: 14px; font-weight: 500; text-decoration: none; display: flex; align-items: center;">
                        مشاهده همه بیماران
                        <i data-lucide="arrow-left" style="width: 16px; height: 16px; margin-right: 4px;"></i>
                    </a>
                </div>
            {% else %}
                <div style="text-align: center; padding: 48px 0;">
                    <div style="width: 64px; height: 64px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                        <i data-lucide="calendar-x" style="width: 32px; height: 32px; color: #9ca3af;"></i>
                    </div>
                    <p style="color: #6b7280; margin-bottom: 16px;">هیچ ویزیت اخیری یافت نشد</p>
                    <a href="{% url 'add_patient' %}" class="btn-primary">افزودن اولین بیمار</a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Recent Patients Table -->
    <div class="card">
        <div class="card-header">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <h3 style="font-size: 20px; font-weight: 600; color: #111827; display: flex; align-items: center;">
                    <i data-lucide="users" style="width: 20px; height: 20px; margin-left: 8px; color: #0284c7;"></i>
                    بیماران اخیر
                </h3>
                <a href="{% url 'patients' %}" style="color: #0284c7; font-size: 14px; font-weight: 500; text-decoration: none; display: flex; align-items: center;">
                    مشاهده همه
                    <i data-lucide="arrow-left" style="width: 16px; height: 16px; margin-right: 4px;"></i>
                </a>
            </div>
        </div>
        
        {% if recent_patients %}
            <div class="table-container">
                <div style="overflow-x: auto;">
                    <table style="width: 100%;">
                        <thead class="table-header">
                            <tr>
                                <th class="table-cell" style="font-weight: 600; color: #374151;">بیمار</th>
                                <th class="table-cell" style="font-weight: 600; color: #374151;">تلفن</th>
                                <th class="table-cell" style="font-weight: 600; color: #374151;">سن</th>
                                <th class="table-cell" style="font-weight: 600; color: #374151;">آخرین ویزیت</th>
                                <th class="table-cell" style="font-weight: 600; color: #374151;">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for patient in recent_patients %}
                            <tr class="table-row">
                                <td class="table-cell">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 48px; height: 48px; background: linear-gradient(to bottom right, #e0f2fe, #bae6fd); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i data-lucide="user" style="width: 24px; height: 24px; color: #0284c7;"></i>
                                        </div>
                                        <div style="margin-left: 16px;">
                                            <div style="font-weight: 600; color: #111827;">{{ patient.full_name }}</div>
                                            <div style="font-size: 14px; color: #6b7280;">کد ملی: {{ patient.national_id }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="table-cell">
                                    <div style="display: flex; align-items: center; color: #111827;">
                                        <i data-lucide="phone" style="width: 16px; height: 16px; margin-left: 8px; color: #9ca3af;"></i>
                                        {{ patient.phone }}
                                    </div>
                                </td>
                                <td class="table-cell">
                                    <span class="badge badge-info">{{ patient.age }} سال</span>
                                </td>
                                <td class="table-cell">
                                    {% if patient.visits.first %}
                                        <div style="display: flex; align-items: center; color: #111827;">
                                            <i data-lucide="calendar" style="width: 16px; height: 16px; margin-left: 8px; color: #9ca3af;"></i>
                                            {{ patient.visits.first.visit_date|jalali:"%Y/%m/%d" }}
                                        </div>
                                    {% else %}
                                        <span class="badge badge-warning">هنوز ویزیتی نداشته</span>
                                    {% endif %}
                                </td>
                                <td class="table-cell">
                                    <a href="{% url 'patient_detail' patient.id %}" class="btn-secondary" style="font-size: 14px;">
                                        <i data-lucide="eye" style="width: 16px; height: 16px; margin-left: 4px;"></i>
                                        مشاهده
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% else %}
            <div style="text-align: center; padding: 64px 0;">
                <div style="width: 80px; height: 80px; background: #f3f4f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;">
                    <i data-lucide="users" style="width: 40px; height: 40px; color: #9ca3af;"></i>
                </div>
                <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 8px;">هیچ بیماری یافت نشد</h3>
                <p style="color: #6b7280; margin-bottom: 24px;">برای شروع، اولین بیمار خود را اضافه کنید</p>
                <a href="{% url 'add_patient' %}" class="btn-primary">
                    <i data-lucide="user-plus" style="width: 20px; height: 20px; margin-left: 8px;"></i>
                    افزودن اولین بیمار
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
